---
substitutions:
  name: soil-moisture-sensor
  friendly_name: Soil Moisture Sensor

esphome:
  name: ${name}
  name_add_mac_suffix: false
  friendly_name: ${friendly_name}

# https://learn.adafruit.com/adafruit-huzzah32-esp32-feather
esp32:
  board: esp32dev
  framework:
    type: arduino

api:

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

ota:
  - platform: esphome
    password: !secret ota_password

deep_sleep:
  run_duration: 65s
  sleep_duration: 5min

sensor:
    # https://murt.is/articles/2021-02/huzzah32-battery-monitoring-esphome.html
  - platform: adc
    id: battery_voltage
    pin: GPIO35 # A13
    name: ESP32 Battery Voltage
    update_interval: 60s
    attenuation: 11db
    filters:
      - lambda: return (x / 3.9) * 2 * 3.3 * 1.1;

  - platform: adc
    pin: GPIO34 # A2
    id: moisture
    update_interval: 5s
    name: Moisture Sensor Voltage
    accuracy_decimals: 3
    unit_of_measurement: V
    filters:
      - sliding_window_moving_average:
          window_size: 16 # 1 minute + last third of the previous run
          send_every: 12 # 1 minute
