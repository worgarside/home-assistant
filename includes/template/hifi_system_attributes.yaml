---
  - binary_sensor:
      - name: "Hifi System: Is Volume Muted"
        unique_id: hifi_system_is_volume_muted
        state: >
          {%
            if (
              state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
              states("media_player.hifi_system_heos") != "idle"
            )
          %}
            {{ state_attr("media_player.hifi_system_heos", "is_volume_muted") }}
          {% else %}
            {{ state_attr("media_player.hifi_system_avr", "is_volume_muted") }}
          {% endif %}

  - sensor:
      - name: "HiFi System: Media Metadata"
        unique_id: hifi_system_media_metadata
        state: >
          {% if state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" %}
            {{ states("media_player.hifi_system_heos") }}
          {% else %}
            {{ states("media_player.hifi_system_avr") }}
          {% endif %}
        picture: >
          {%
            if (
              state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
              states("media_player.hifi_system_heos") != "idle"
            )
          %}
            {{ state_attr("media_player.hifi_system_heos", "entity_picture") }}
          {% else %}
            {{ state_attr("media_player.hifi_system_avr", "entity_picture") }}
          {% endif %}
        attributes:
          media_album_name: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "media_album_name") }}
            {% endif %}
          media_artist: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "media_artist") }}
            {% endif %}
          media_content_id: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "media_content_id") }}
            {% endif %}
          media_duration: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "media_duration") }}
            {% endif %}
          media_title: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "media_title") }}
            {% endif %}
          media_shuffle: >
            {%
              if (
                state_attr("media_player.hifi_system_avr", "source") == "HEOS Music" and
                states("media_player.hifi_system_heos") != "idle"
              )
            %}
              {{ state_attr("media_player.hifi_system_heos", "shuffle") }}
            {% endif %}
