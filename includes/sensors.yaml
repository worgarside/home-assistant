  - platform: london_air

  - platform: rest
    resource: http://ip.jsontest.com
    name: External IP
    scan_interval: 300
    value_template: '{{ value_json.ip }}'

  - platform: rest
    name: Will's Room Curtain Position
    scan_interval: 30
    method: GET
    force_update: true
    resource: !secret switchbot_curtain_status_endpoint
    headers:
      Authorization: !secret switchbot_api_key
      Content-Type: application/json
    # The scale is 0-100, but SwitchBot and HA have opposing views on which way round
    # it should be, hence the `100 - ...` here
    value_template: >
      {%
        if 100 - ( value_json.body.slidePosition | int ) < (
          20
          if states('binary_sensor.will_s_balcony_door') == "on"
          else 4
        )
      %}
        0
      {% elif 100 - ( value_json.body.slidePosition | int ) > 96  %}
        100
      {% else %}
        {{ 100 - ( value_json.body.slidePosition | int ) }}
      {% endif %}

    unit_of_measurement: '%'
    json_attributes_path: $.body
    json_attributes:
      - deviceId
      - deviceType
      - hubDeviceId
      - calibrate
      - group
      - moving
      - slidePosition

  - platform: rest
    name: Nabu Casa Online
    method: GET
    scan_interval: 150
    force_update: true
    resource: !secret nabu_casa_url_online_sensor
    headers:
      Authorization: !secret nabu_casa_online_access_token
      Content-Type: application/json
    value_template: "{{ value_json['state'] }}"
    unit_of_measurement: '%'

  - platform: spotcast
    country: GB

  - platform: systemmonitor
    resources:
      - type: disk_use_percent
      # - type: disk_use
      # - type: disk_free
      - type: memory_use_percent
      # - type: memory_use
      # - type: memory_free
      - type: swap_use_percent
      # - type: swap_use
      # - type: swap_free
      # - type: load_1m
      # - type: load_5m
      # - type: load_15m
      - type: network_in
        arg: eth0
      - type: network_out
        arg: eth0
      - type: throughput_network_in
        arg: eth0
      - type: throughput_network_out
        arg: eth0
      # - type: packets_in
      #   arg: eth0
      # - type: packets_out
      #   arg: eth0
      - type: ipv4_address
        arg: eth0
      - type: ipv6_address
        arg: eth0
      - type: processor_use
      - type: processor_temperature

  - platform: feedparser
    name: Error Feed
    feed_url: http://homeassistant.local:8001/feed/logs?level=error
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60

  - platform: feedparser
    name: Info Feed
    feed_url: http://homeassistant.local:8001/feed/logs?level=info
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60

  - platform: feedparser
    name: Debug Feed
    feed_url: http://homeassistant.local:8001/feed/logs?level=debug
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60

  - platform: feedparser
    name: Warning Feed
    feed_url: http://homeassistant.local:8001/feed/logs?level=warning
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60

  - platform: feedparser
    name: Critical Feed
    feed_url: http://homeassistant.local:8001/feed/logs?level=critical
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60

  - platform: feedparser
    name: Log Feed
    feed_url: http://homeassistant.local:8001/feed/logs
    date_format: '%Y-%m-%d %H:%M:%S'
    scan_interval:
      seconds: 60
