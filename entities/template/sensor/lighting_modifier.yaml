---
name: Lighting Modifier

unique_id: lighting_modifier

unit_of_measurement: "%"

icon: mdi:brightness-percent

state: >-
  {% set sun = states("sensor.sun_elevation") | float(0) %}
  {% set quiet_hours = states("binary_sensor.quiet_hours") | bool(false) %}
  {% set weekday = states("binary_sensor.weekday") | bool(false) %}
  {% set current_hour = states("sensor.current_hour") | int(12) %}

  {% set base_brightness =
    100 if sun >= 2 else
    60 if sun >= -1 else
    30 if sun >= -6 else
    10 if sun >= -12 else
    5 if sun >= -18 else
    1
  %}

  {% set base_brightness = min(base_brightness, 30) if current_hour < 7 else base_brightness %}
  {% set base_brightness = max(base_brightness, 10) if current_hour < 23 else base_brightness %}

  {% if weekday and 9 <= current_hour < 18 %}
    100
  {% elif weekday and 0 <= current_hour < 7 %}
    {{ base_brightness }}
  {% elif quiet_hours and sun >= 2 %}
    75
  {% else %}
    {{ base_brightness }}
  {% endif %}
