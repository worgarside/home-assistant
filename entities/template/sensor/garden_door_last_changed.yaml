---
name: Garden Door | Last Changed

unique_id: garden_door_last_changed

state: >-
  {%
    set delta = (
      states("sensor.date_time_iso") | as_datetime | as_local -
      states.binary_sensor.garden_door.last_changed
    ).total_seconds() | int
  %}
  {% set mins = delta // 60 %}
  {% set hrs = mins // 60 %}
  {% set rem_mins = mins % 60 %}
  {% if hrs < 1 %}
    {{ mins }} mins ago
  {% else %}
    {{ hrs }} hr{{ 's' if hrs > 1 else '' }} {{ rem_mins }} mins ago
  {% endif %}

icon: >-
  {%
    set delta = (
      states("sensor.date_time_iso") | as_datetime | as_local -
      states.binary_sensor.garden_door.last_changed
    ).total_seconds() | int
  %}
  {% set mins = delta // 60 %}
  {% if mins < 15 %}
    mdi:check-circle
  {% elif mins < 45 %}
    mdi:clock-outline
  {% else %}
    mdi:alert-circle
  {% endif %}
