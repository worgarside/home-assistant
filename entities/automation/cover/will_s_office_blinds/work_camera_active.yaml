---
alias: /cover/will-s-office-blinds/work-camera-active

id: cover_will_s_office_blinds_work_camera_active

mode: single

max_exceeded: silent

description: >-
  Closes Will's office blinds when Will is at home and the work MacBook Pro
  starts using the configured work camera, and re-opens them when the camera has
  not been used for 60 seconds (only if the blinds were originally open).

trigger:
  - platform: template
    value_template: >-  
      {{
        is_state(
          "sensor.work_macbook_pro_active_camera",
          states("input_text.will_s_office_webcam_name")
        )
      }}
    for:
      seconds: 10

variables:
  blinds_were_open: "{{ is_state('cover.will_s_office_blinds', 'open') }}"

condition:
  - condition: state
    entity_id: person.will
    state: home

action:
  - service: cover.close_cover
    target:
      entity_id: cover.will_s_office_blinds

  - if: "{{ blinds_were_open }}"
    then:
      - wait_for_trigger:
          - platform: template
            value_template: >-
              {{
                not is_state(
                  "sensor.work_macbook_pro_active_camera",
                  states("input_text.will_s_office_webcam_name")
                )
              }}
            for:
              seconds: 60

      - service: cover.open_cover
        target:
          entity_id: cover.will_s_office_blinds
