---
alias: /webhook/git_branch_or_tag_deleted

id: webhook_git_branch_or_tag_deleted

mode: queued

trigger:
  - platform: webhook
    webhook_id: git_branch_or_tag_deleted
    allowed_methods:
      - POST
    local_only: false

condition:
  - condition: template
    value_template: >-
      {{
        trigger.json["repository"]["name"] == "home-assistant" and
        trigger.json["ref_type"] == "branch"
      }}

action:
  - service: script.debug_persistent_notification
    data:
      title: Git branch deleted
      message: >-
        {{ trigger.json["sender"]["login"] }} deleted branch
        {{ trigger.json["ref"] }} in
        {{ trigger.json["repository"]["full_name"] }}
      notification_id: "git_branch_or_tag_deleted_{{ trigger.json['ref'] }}"

  - service: homeassistant.update_entity
    target:
      entity_id: sensor.remote_git_branches
