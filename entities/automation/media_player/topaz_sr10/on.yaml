---
alias: /media-player/topaz-sr10/on

id: media_player_topaz_sr10_on

description: >-
  Automation to run when the Topaz SR10 is turned on by something other than the
  `media_player.turn_on` service.

mode: single

trigger:
  platform: state
  entity_id: media_player.topaz_sr10
  from: "off"
  to:
    - "on"
    - "playing"
    - "paused"
    - "idle"
    - "standby"

action:
  - if: "{{ is_state('switch.office_amp', 'off') }}"

    then:
      - service: switch.turn_on
        target:
          entity_id: switch.office_amp

      - delay:
          seconds: 5

    else:
      - delay:
          seconds: 2.5

  - alias: Set Amp to Correct Input
    service: media_player.select_source
    target:
      entity_id: media_player.topaz_sr10
    data:
      source: MP3/Aux

  - alias: Initialize volume
    repeat:
      until: "{{ states('input_number.topaz_sr10_volume_level') | int(-35) >= -35 }}"

      sequence:
        - service: media_player.volume_up
          target:
            entity_id: media_player.topaz_sr10
