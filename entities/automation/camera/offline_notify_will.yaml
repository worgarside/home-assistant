---
alias: /camera/offline-notify-will

id: camera_offline_notify_will

description: Notify Will when either basement or lounge camera goes offline

mode: queued

max_exceeded: silent

max: 4

trigger:
  - platform: state
    entity_id: camera.basement
    to:
      - recording
      - unavailable
    for:
      minutes: 1

  - platform: state
    entity_id: camera.lounge
    to:
      - recording
      - unavailable
    for:
      minutes: 1

variables:
  camera_name: >-
    {% if trigger.entity_id == 'camera.basement' %}
      Basement
    {% elif trigger.entity_id == 'camera.lounge' %}
      Lounge
    {% else %}
      Unknown
    {% endif %}

action:
  - if: "{{ trigger.to_state.state == 'unavailable' }}"

    then:
      - service: script.notify_will
        data:
          title: "Camera Offline"
          message: "{{ camera_name }} camera is offline"
          group: camera-offline
          mobile_notification_icon: mdi:cctv
          notification_id: camera_offline_{{ camera_name }}

    else:
      - service: script.notify_will
        data:
          clear_notification: true
          notification_id: camera_offline_{{ camera_name }}
          message: clear_notification
