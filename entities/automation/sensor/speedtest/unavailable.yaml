---
alias: /sensor/speedtest/unavailable

id: sensor_speedtest_unavailable

description: >-
  Reload speedtest config entry when any speedtest sensor becomes unavailable for 30 seconds

mode: single

max_exceeded: silent

trigger:
  - platform: state
    entity_id:
      - sensor.speedtest_upload
      - sensor.speedtest_ping
      - sensor.speedtest_download
    to: "unavailable"
    for:
      seconds: 30

action:
  - service: script.debug_persistent_notification
    data:
      message: >-
        Speedtest sensor {{ trigger.entity_id }} became unavailable for 30+ seconds.
        Reloading speedtest config entry.
      notification_title: Speedtest Sensor Unavailable
      notification_id: speedtest_sensor_unavailable

  - service: homeassistant.reload_config_entry
    target:
      entity_id: sensor.speedtest_download
    data:
      entry_id: 0cfae871c5302278e74c3ab42a713f09
