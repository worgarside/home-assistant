---
alias: /input-text/test-mqtt-events-device-id/log-event

id: input_text_test_mqtt_events_device_id_log_event

description: >-
  Log MQTT device events for the device ID specified in input_text.test_mqtt_events_device_id. This
  automation listens to Zigbee2MQTT MQTT topics and filters by device_id to capture device events.

mode: queued

max: 100

trigger:
  - platform: mqtt
    topic: zigbee2mqtt/+/action
  - platform: mqtt
    topic: zigbee2mqtt/+/click
  - platform: mqtt
    topic: zigbee2mqtt/+/#

variables:
  target_device_id: "{{ states('input_text.test_mqtt_events_device_id') }}"

condition:
  - condition: template
    value_template: >-
      {{
        target_device_id != ''
      }}

action:
  - service: script.turn_on
    target:
      entity_id: script.debug_persistent_notification
    data:
      variables:
        notification_title: MQTT Device Event ({{ target_device_id }})
        message: |
          **Target Device ID:** {{ target_device_id }}

          **MQTT Topic:** {{ trigger.topic }}

          **MQTT Payload:**
          ```json
          {{ trigger.payload | default('No payload') }}
          ```

          **Parsed JSON Payload (if JSON):**
          ```json
          {{ trigger.payload_json | default('Not JSON or no payload') | tojson(indent=2) }}
          ```

          **Full Trigger Object:**
          ```json
          {{ trigger | tojson(indent=2) }}
          ```
        notification_id: mqtt_device_event_{{ target_device_id }}
