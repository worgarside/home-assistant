---
alias: /remote/prusa-i3-mk3-power/double-press

id: remote_prusa_i3_mk3_power_double_press

mode: single

max_exceeded: silent

trigger:
  - platform: event
    event_type: zha_event
    event_data:
      command: double
      device_ieee: 00:15:8d:00:09:ee:2b:f2

action:
  - choose:
      - alias: Printer is completely off
        conditions: "{{ is_state('switch.prusa_i3_mk3_power', 'off') }}"
        sequence:
          - service: switch.turn_on
            target:
              entity_id: switch.prusa_i3_mk3_power

      - alias: Printer is on but Octoprint isn't connected
        conditions: "{{ is_state('binary_sensor.octoprint_connected', 'off') }}"
        sequence:
          - service: switch.turn_on
            target:
              entity_id: switch.octoprint_connect_to_printer

    default:
        action
      

    - wait_template: "{{ is_state('binary_sensor.octoprint_connected', 'on') }}"
      timeout: '00:00:30'
