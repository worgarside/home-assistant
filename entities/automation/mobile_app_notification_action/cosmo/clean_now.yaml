---

alias: /mobile_app_notification_action/cosmo/clean_now

description: Get Cosmo to clean a room immediately, triggered from a mobile notification

id: mobile_app_notification_action_cosmo_clean_now

mode: restart

trigger:
  platform: event
  event_type: mobile_app_notification_action

condition:
  condition: template
  value_template: >-
    {% set parts = ( trigger.event.data.action | default("") ).split(":") %}

    {{
      parts | length == 3 and
      parts[0].casefold() == "cosmo" and
      parts[1].casefold() == "clean_now"
    }}

action:
  - service: script.cosmo_clean_room
    data:
      room_name: "{{ trigger.event.data.action.split(':')[2] }}"
      extend_wait_time: true
