---
alias: /switch/office_amp/auto_turn_off
id: switch_office_amp_auto_turn_off
trigger:
  - platform: state
    entity_id: media_player.office_speakers
    from:
      - idle
      - paused
      - playing
      - on
    to:
      - idle
      - off
      - unavailable
      - unknown
    for:
      minutes: 2
  - platform: state
    entity_id:
      - sensor.st_macbook_pro_active_audio_output
      - sensor.wills_macbook_pro_active_audio_output
    from: FiiO USB DAC-E10
    not_to: Inactive
    for:
      minutes: 1
  - platform: state
    entity_id:
      - sensor.st_macbook_pro_active_audio_output
      - sensor.wills_macbook_pro_active_audio_output
    from: FiiO USB DAC-E10
    to: Inactive
    for:
      minutes: 5
condition:
  - condition: and
    conditions:
      - condition: state
        entity_id: media_player.office_speakers
        state:
          - idle
          - off
          - unavailable
          - unknown
      - not:
          - condition: state
            entity_id: sensor.st_macbook_pro_active_audio_output
            state: FiiO USB DAC-E10
          - condition: state
            entity_id: sensor.wills_macbook_pro_active_audio_output
            state: FiiO USB DAC-E10
action:
  - service: switch.turn_off
    entity_id: switch.office_amp
