---
alias: /light/will-s-office-grow-light/off

id: light_will_s_office_grow_light_off

description: >-
  Turn off grow light when any condition becomes invalid: office occupied, light outside,
  openings detected, or doors open.

mode: restart

trigger:
  # Office becomes occupied
  - platform: state
    entity_id: binary_sensor.will_s_office_occupancy
    to: "on"

  # Sun rises (becomes light outside)
  - platform: numeric_state
    entity_id: sensor.sun_elevation
    above: -3

  # External openings detected
  - platform: state
    entity_id:
      - binary_sensor.roof_terrace_door_contact
      - binary_sensor.will_s_office_window_sensor_contact
    to: "on"

  # Office door opens
  - platform: state
    entity_id: binary_sensor.office_door_sensor_contact
    to: "on"

  # Blinds opened
  - platform: state
    entity_id: cover.will_s_office_blinds
    from: "closed"
    id: blinds_opened

  # TODO: Add bedroom door trigger when sensor becomes available
  # When both office door AND bedroom door are open, light should turn off
  # - platform: state
  #   entity_id: binary_sensor.bedroom_door_sensor_contact
  #   to: "on"

condition:
  - condition: state
    entity_id: light.esphome_rf_bridge_will_s_office_grow_light
    state: "on"

action:
  - service: light.turn_off
    target:
      entity_id: light.esphome_rf_bridge_will_s_office_grow_light
