---
alias: /light/will-s-office-voice-assistant-led-ring/door-open-flash

id: light_will_s_office_voice_assistant_led_ring_door_open_flash

mode: single

description: >-
  Flashes Will's office voice assistant LED ring red at 100% brightness when the office door is
  opened, then restores the previous color and brightness.

trigger:
  - platform: state
    entity_id: binary_sensor.office_door_sensor_contact
    to: "on"

action:
  # Save current state
  - variables:
      was_on: "{{ is_state('light.will_s_office_voice_assistant_led_ring', 'on') }}"
      saved_color: "{{ state_attr('light.will_s_office_voice_assistant_led_ring', 'rgb_color') }}"
      saved_brightness: >-
        {{
          state_attr('light.will_s_office_voice_assistant_led_ring', 'brightness')
        }}

  # First flash red at 100% brightness
  - service: light.turn_on
    target:
      entity_id: light.will_s_office_voice_assistant_led_ring
    data:
      rgb_color: [255, 0, 0]
      brightness_pct: 100

  # Wait for first flash duration
  - delay:
      seconds: 1

  # Brief pause between flashes
  - service: light.turn_off
    target:
      entity_id: light.will_s_office_voice_assistant_led_ring

  - delay:
      seconds: 0.5

  # Second flash red at 100% brightness
  - service: light.turn_on
    target:
      entity_id: light.will_s_office_voice_assistant_led_ring
    data:
      rgb_color: [255, 0, 0]
      brightness_pct: 100

  # Wait for second flash duration
  - delay:
      seconds: 1

  # Restore previous state
  - if: "{{ was_on }}"

    then:
      - service: light.turn_on
        target:
          entity_id: light.will_s_office_voice_assistant_led_ring
        data:
          rgb_color: "{{ saved_color }}"
          brightness: "{{ saved_brightness }}"

    else:
      - service: light.turn_off
        target:
          entity_id: light.will_s_office_voice_assistant_led_ring
