---
alias: /binary-sensor/will-s-desk-occupancy/state-change

id: binary_sensor_will_s_desk_occupancy_state_change

mode: queued

trigger:
  - platform: state
    entity_id: binary_sensor.will_s_desk_occupancy
    to:
      - "on"
      - "off"

action:
  - if: "{{ trigger.to_state.state | bool }}"

    then:
      - if: "{{ state_attr('var.will_s_desk_state_manager', 'fan.desk_fan') | bool(false) }}"
        then:
          - service: fan.turn_on
            target:
              entity_id: fan.desk_fan

      - if: "{{ state_attr('var.will_s_desk_state_manager', 'light.desk_lamp') | bool(false) }}"
        then:
          - service: light.turn_on
            target:
              entity_id: light.desk_lamp

      - if: "{{ state_attr('var.will_s_desk_state_manager', 'light.office_shapes') | bool(false) }}"
        then:
          - service: light.turn_on
            target:
              entity_id: light.office_shapes

    else:
      - if: "{{ is_state('fan.desk_fan', 'on') }}"
        then:
          - service: automation.turn_off
            target:
              entity_id: automation.fan_desk_fan_state_change

          - service: fan.turn_off
            target:
              entity_id: fan.desk_fan

          - service: automation.turn_on
            target:
              entity_id: automation.fan_desk_fan_state_change

      - if: "{{ is_state('light.desk_lamp', 'on') }}"
        then:
          - service: automation.turn_off
            target:
              entity_id: automation.light_desk_lamp_state_change

          - service: light.turn_off
            target:
              entity_id: light.desk_lamp

          - service: automation.turn_on
            target:
              entity_id: automation.light_desk_lamp_state_change

      - if: "{{ is_state('light.office_shapes', 'on') }}"
        then:
          - service: automation.turn_off
            target:
              entity_id: automation.light_office_shapes_state_change

          - service: light.turn_off
            target:
              entity_id: light.office_shapes

          - service: automation.turn_on
            target:
              entity_id: automation.light_office_shapes_state_change
