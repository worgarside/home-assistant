---
alias: /binary-sensor/kitchen-occupancy/state-change

id: binary_sensor_kitchen_occupancy_state_change

mode: queued

max_exceeded: silent

trigger:
  - platform: state
    entity_id: binary_sensor.kitchen_occupancy
    to: "on"
  - platform: state
    entity_id: binary_sensor.kitchen_occupancy
    to: "off"
    for:
      seconds: "{{ states('input_number.basement_room_vacancy_light_timeout') | int(5) }}"

action:
  - if: >-
      {{
        trigger.entity_id == 'binary_sensor.kitchen_occupancy' and
        trigger.from_state.state == 'on' and
        trigger.to_state.state == 'off'
      }}

    then:
      - delay:
          seconds: 5

  - service: script.kitchen_set_lighting_based_on_occupancy
