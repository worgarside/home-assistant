---
alias: Kitchen | Set Lighting Based on Occupancy

description: Set kitchen lighting based on current occupancy state

mode: single

variables:
  kitchen_multiplier: "{{ 1 if now().hour >= 23 or now().hour < 7 else 2.5 }}"
  modifier: "{{ states('sensor.lighting_modifier') | int(70) }}"

sequence:
  - if: "{{ is_state('binary_sensor.kitchen_occupancy', 'on') }}"
    then:
      - parallel:
          - service: light.turn_on
            target:
              entity_id:
                - light.kitchen_counter_lights
                - light.kitchen_spotlights
            data:
              brightness_pct: "{{ min(modifier * kitchen_multiplier, 100) }}"
              transition: 1

          - service: light.turn_on
            target:
              entity_id: light.kitchen_island
            data:
              # Keep kitchen island brighter for cooking
              brightness_pct: >-
                {{
                  max(
                    min(modifier * kitchen_multiplier, 100),
                    (40 if 12 <= now().hour < 23 else 0)
                  )
                }}
              transition: 1

    else:
      - parallel:
          # Kitchen: spotlights at 15%, island at 50%
          - service: light.turn_on
            target:
              entity_id: light.kitchen_spotlights
            data:
              brightness_pct: "{{ (modifier * 0.15) | round(0, 'ceil') }}"
              transition: 1

          - service: light.turn_on
            target:
              entity_id:
                - light.kitchen_island
                - light.kitchen_counter_lights
            data:
              brightness_pct: "{{ (modifier * 0.5) | round(0, 'ceil') }}"
              transition: 1
