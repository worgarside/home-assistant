---
alias: Send Bedroom Sunrise Notification

description: Send sunrise notification with countdown timer to both phones

mode: single

fields:
  clear_notification:
    description: Clear the notification
    example: "true"
    selector:
      boolean:

variables:
  clear_notification: "{{ clear_notification | default(False) | bool(False) }}"

sequence:
  - if: "{{ clear_notification }}"

    then:
      - alias: Clear sunrise notifications
        service: notify.mobile_app_victorias_iphone
        data:
          message: clear_notification
          data:
            tag: sunrise-alarm

      - service: notify.mobile_app_will_s_pixel_6_pro
        data:
          message: clear_notification
          data:
            tag: sunrise-alarm

    else:
      - alias: Calculate notification timeout
        variables:
          notif_timeout: 1800

      - alias: Send sunrise notification to Vic
        if:
          - condition: state
            entity_id: person.vic
            state: home
        then:
          - service: notify.mobile_app_victorias_iphone
            data:
              title: Good morning!
              message: Rise and shine!
              data:
                actions:
                  - action: BEDROOM_SUNRISE_DELAY_15
                    title: "Start in 15 mins"
                  - action: BEDROOM_SUNRISE_DELAY_30
                    title: "Start in 30 mins"
                  - action: BEDROOM_SUNRISE_STOP
                    title: "Stop Sunrise"
                tag: sunrise-alarm
                group: sunrise-alarm
                push:
                  sound: none
                  interruption-level: passive
                  badge: 1

      - alias: Send sunrise notification to Will
        if:
          - condition: state
            entity_id: person.will
            state: home
        then:
          - service: notify.mobile_app_will_s_pixel_6_pro
            data:
              title: Good morning!
              message: Rise and shine!
              data:
                persistent: true
                actions:
                  - action: BEDROOM_SUNRISE_DELAY_15
                    title: "Start in 15 mins"
                  - action: BEDROOM_SUNRISE_DELAY_30
                    title: "Start in 30 mins"
                  - action: BEDROOM_SUNRISE_STOP
                    title: "Stop Sunrise"
                tag: sunrise-alarm
                group: sunrise-alarm
                channel: Sunrise
                importance: min
                vibrationPattern: "100"
                timeout: "{{ notif_timeout }}"
                chronometer: true
                when: "{{ notif_timeout }}"
                when_relative: true
                sound: none
                notification_icon: "mdi:weather-sunset-up"
                sticky: true
                alert_once: true
