---
alias: Dining Area | Set Lighting Based on Occupancy

description: Set dining area lighting based on current occupancy state

mode: single

variables:
  color_temp_kelvin: 2500
  modifier: "{{ states('sensor.lighting_modifier') | int(70) }}"

sequence:
  - if: "{{ is_state('binary_sensor.dining_area_occupancy', 'on') }}"
    then:
      # Dining area lights at full brightness
      - service: light.turn_on
        target:
          area_id: dining_area
        data:
          brightness_pct: "{{ modifier }}"
          color_temp_kelvin: "{{ color_temp_kelvin }}"
          transition: 1

    else:
      - parallel:
          # big light at 50%, shelves at 25%, spotlights off
          - service: light.turn_on
            target:
              entity_id: light.dining_area_big_light
            data:
              brightness_pct: "{{ (modifier * 0.5) | round(0, 'ceil') }}"
              color_temp_kelvin: "{{ color_temp_kelvin }}"
              transition: 1

          - service: light.turn_on
            target:
              entity_id: light.dining_area_shelves
            data:
              brightness_pct: "{{ (modifier * 0.25) | round(0, 'ceil') }}"
              color_temp_kelvin: "{{ color_temp_kelvin }}"
              transition: 1

          - service: light.turn_off
            target:
              entity_id: light.dining_area
            data:
              transition: 1
