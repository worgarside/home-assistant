---
alias: GH Issue Create

description: Create a new issue on GitHub

mode: queued

fields:
  issue_title:
    name: Issue Title
    description: The title of the issue
    required: true
    selector:
      text:

  labels:
    name: Labels
    description: Add one or more labels to the issue
    required: true
    selector:
      select:
        multiple: true
        options:
          - bug
          - chore
          - feature-request
          - refactor
          - major
          - minor
          - patch
          - tools

  body:
    name: Issue Body
    description: The main body of the issue
    required: true
    selector:
      text:
        multiline: true

  assignee:
    name: Assignee
    description: Who to assign the issue to
    default: "@worgarside"
    selector:
      select:
        options:
          - "@worgarside"

  repository:
    name: Repository
    description: The repo to open the issue in
    default: home-assistant
    required: true
    selector:
      select:
        multiple: false
        options:
          - github-config-files
          - home-assistant
          - home-assistant-appdaemon
          - home-assistant-config-validator
          - led-matrix-controller
          - wg-scripts
          - wg-utilities

variables:
  message_args: >-
    --title "{{- issue_title -}}"
    --body "{{- body -}}"
    {%- if labels -%}
      --label "{{- labels | join(',') -}}"
    {%- endif -%}
    --assignee "{{- assignee | default('@worgarside') -}}"
    --repo "worgarside/{{- repository | default('home-assistant') -}}"

sequence:
  - service: shell_command.gh
    data:
      command: issue create
      args: "{{ message_args }}"
    response_variable: response

  - stop: Return response
    response_variable: response
