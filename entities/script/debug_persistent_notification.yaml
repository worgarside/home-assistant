---
description: Create a persistent notification if debugging is turned on

fields:
  message:
    description: The notification's message body
    example: More detail about this thing

  title:
    description: The notification's title
    example: Something has happened!

  notification_id:
    description: Optional ID for the persistent notification
    example: important_thing_happened

mode: parallel

variables:
  notif_title: "{{ title | default(' ') }}"

sequence:
  - service: system_log.write
    data:
      message: "{{ message }}"
      level: debug
      logger: script.debug_with_persistent_notifications

  - alias: Check if debugging is turned on
    condition: state
    entity_id: input_boolean.debug_with_persistent_notifications
    state: "on"

  - service: persistent_notification.create
    data:
      message: "{{ message }}"
      title: "{{ notif_title }}"
      notification_id: >-
        {{
          notification_id |
          default('notify_debug_' ~ now().strftime('%Y%m%d%H%M%S%f'))
        }}
