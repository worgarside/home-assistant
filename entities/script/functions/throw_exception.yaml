---
description: Throw an exception, ending the calling execion

mode: parallel

fields:
  calling_entity:
    description: The entity that called this service
    required: true

  message:
    description: The message to be logged
    required: true

variables:
  entity_domain: "{{ calling_entity.split('.')[0] }}"
  timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

sequence:
  - servic: persistent_notification.create
    data:
      title: ⚠️ Error thrown by {{ entity_domain.replace('_', ' ').title() }}
      message: |
        Source:  `{{ calling_entity }}`
        Time:    `{{ timestamp }}`
        Message: `{{ message }}`

  - service: system_log.write
    data:
      message: "{{ message }}"
      level: error
      logger: "{{ calling_entity }}"

  - stop: Exception Thrown
    error: true
