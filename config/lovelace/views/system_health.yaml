---
title: System Health

icon: mdi:medication

path: system_health

#type: custom:grid-layout

layout:
  max_cols: 3

cards:

  - type: custom:auto-entities
    view_layout:
      grid-column-start: 3;
      grid-column-end: 3;
    card:
      type: entities
      title: Unavailable Entities
      show_header_toggle: false
    sort:
      method: domain
    filter:
      include:
        - state: "unavailable"
      exclude:
        # Exclude anything from browser mod, named like "domain.a1b2c3d4_e5f6g7h8"
        - entity_id: /^light\.(?=[a-z]*\d)([a-z]|\d){8}_(?=[a-z]*\d)([a-z]|\d){8}$/
          # yamllint disable-line rule:line-length
        - entity_id: /^media_player\.(?=[a-z]*\d)([a-z]|\d){8}_(?=[a-z]*\d)([a-z]|\d){8}$/
        - entity_id: /^sensor\.(?=[a-z]*\d)([a-z]|\d){8}_(?=[a-z]*\d)([a-z]|\d){8}$/
        - entity_id: /^switch\..*_led$/ # TP Link switch LEDs

  - type: custom:vertical-stack-in-card
    cards:
      - type: glance
        entities:
          - entity: sensor.count_automations
            name: Automations
          - entity: sensor.count_binary_sensors
            name: Binary Sensors
          - entity: sensor.count_device_trackers
            name: Devices
          - entity: sensor.count_input_booleans
            name: Input Booleans
          - entity: sensor.count_input_datetimes
            name: Input Datetimes
          - entity: sensor.count_input_numbers
            name: Input Numbers
          - entity: sensor.count_input_selects
            name: Input Selects
          - entity: sensor.count_input_texts
            name: Input Texts
          - entity: sensor.count_scripts
            name: Scripts
          - entity: sensor.count_sensors
            name: Sensors
          - entity: sensor.count_switches
            name: Switches
          - entity: sensor.count_zones
            name: Zones

      - type: glance
        entities:
          - entity: sensor.database_size
            name: Database

  - type: entities
    title: Netgear Entities
    entities:
      - entity: var.netgear_r8000_model_name
      - entity: var.netgear_r8000_description
      - entity: var.netgear_r8000_serial_number
      - entity: var.netgear_r8000_firmware_version
      - entity: var.netgear_r8000_smart_agent_version
      - entity: var.netgear_r8000_firewall_version
      - entity: var.netgear_r8000_vpn_version
      - entity: var.netgear_r8000_other_software_version
      - entity: var.netgear_r8000_hardware_version
      - entity: var.netgear_r8000_other_hardware_version
      - entity: var.netgear_r8000_first_use_date
      - entity: var.netgear_r8000_device_name
      - entity: var.netgear_r8000_firmware_dl_method
      - entity: var.netgear_r8000_firmware_last_update
      - entity: var.netgear_r8000_firmware_last_checked
      - entity: var.netgear_r8000_device_mode
      - entity: var.netgear_r8000_today_connection_time
      - entity: var.netgear_r8000_today_upload
      - entity: var.netgear_r8000_today_download
      - entity: var.netgear_r8000_yesterday_connection_time
      - entity: var.netgear_r8000_yesterday_upload
      - entity: var.netgear_r8000_yesterday_download
      - entity: var.netgear_r8000_week_connection_time
      - entity: var.netgear_r8000_month_connection_time
      - entity: var.netgear_r8000_last_month_connection_time
      - entity: var.netgear_r8000_week_upload_total
      - entity: var.netgear_r8000_week_upload_average
      - entity: var.netgear_r8000_week_download_total
      - entity: var.netgear_r8000_week_download_average
      - entity: var.netgear_r8000_month_upload_total
      - entity: var.netgear_r8000_month_upload_average
      - entity: var.netgear_r8000_month_download_total
      - entity: var.netgear_r8000_month_download_average
      - entity: var.netgear_r8000_last_month_upload_total
      - entity: var.netgear_r8000_last_month_upload_average
      - entity: var.netgear_r8000_last_month_download_total
      - entity: var.netgear_r8000_last_month_download_average
      - entity: var.netgear_r8000_current_firmware_version
      - entity: var.netgear_r8000_new_firmware_version
      - entity: var.netgear_r8000_firmware_release_note
      - entity: var.netgear_r8000_cpu_utilization
      - entity: var.netgear_r8000_physical_memory
      - entity: var.netgear_r8000_memory_utilization
      - entity: var.netgear_r8000_physical_flash
      - entity: var.netgear_r8000_available_flash
      - entity: var.netgear_r8000_ethernet_link_status
      - entity: var.netgear_r8000_enable
      - entity: var.netgear_r8000_connection_type
      - entity: var.netgear_r8000_external_ip_address
      - entity: var.netgear_r8000_subnet_mask
      - entity: var.netgear_r8000_addressing_type
      - entity: var.netgear_r8000_default_gateway
      - entity: var.netgear_r8000_mac_address
      - entity: var.netgear_r8000_mac_address_override
      - entity: var.netgear_r8000_max_mtu_size
      - entity: var.netgear_r8000_dns_enabled
      - entity: var.netgear_r8000_dns_servers
      - entity: var.netgear_r8000_uplink_bandwidth
      - entity: var.netgear_r8000_downlink_bandwidth
      - entity: var.netgear_r8000_average_ping

  - type: entities
    entities:
      - type: custom:fold-entity-row
        head:
          type: section
          label: Task Scheduler
          card_mod:
            style: |
              div.divider {
                display: none;
              }
              .label {
                font-size: 24px;
                font-weight: 400 !important;
                margin-bottom: 0px !important;
              }
        entities:
          - type: custom:vertical-stack-in-card
            cards:
              - type: entities
                entities:
                  - entity: input_text.task_scheduler_trigger_entity_id
                    name: Entity ID
                  - entity: input_text.task_scheduler_trigger_state
                    name: State
                  - entity: input_text.task_scheduler_service_call
                    name: Service Call
                  - entity: input_text.task_scheduler_repeat_count
                    name: Repeat Count
              - type: custom:lovelace-multiline-text-input-card
                entity: input_text.task_scheduler_service_kwargs
                placeholder_text: Add kwargs for the service call here (YAML format)
                title: Service Call Kwargs
                max_length: 255
                style: |
                  div.card-header, div > textarea.textarea {
                    background-color: var(--mdc-text-field-fill-color, whitesmoke);
                  }
                  div.card-header {
                    border-radius: 4px 4px 0 0;
                    padding: 0px 15px;
                    margin: 0 16px;
                    color: var(--mdc-text-field-label-ink-color, rgba(0, 0, 0, 0.6));
                    font-size: 16px;
                    height: 40px;
                  }
                  div.card-content {
                    padding-bottom: 0px;
                  }
                  div.card-content > textarea.textarea {
                    margin-top: 8px;
                    padding-top: 8px;
                    padding-left: 16px;
                    width: calc(100% - 19px);
                    border-color: #00000000;
                    font-family: monospace;
                    border-bottom-width: 1px;
                    border-bottom-color: #828282;
                  }
                  div.card-content > textarea.textarea:focus {
                    background-color: #2D2D2D;
                    border-bottom-color: white;
                  }
                  div.card-content > span#spanMaxCharactersInfoText {
                    display: none;
                  }

          - type: button
            name: Schedule Task
            show_state: false
            icon: mdi:timer-play
            tap_action:
              action: call-service
              service: pyscript.create_task
      - type: custom:list-card
        entity: sensor.scheduled_tasks
        title: Scheduled Tasks
        feed_attribute: scheduledTasks
        columns:
          - title: Entity ID
            field: trigger_entity_id
          - title: Trigger State
            field: trigger_state
          - title: Service Call
            field: service_call
          - title: Kwargs
            field: service_kwargs
          - title: Runs Remaining
            field: runs_remaining

  - type: horizontal-stack
    title: Internet Speeds
    cards:
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.speedtest_download
            name: Download
        icon: mdi:download-network-outline
        line_color: blue
        line_width: 8
        font_size: 75
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.speedtest_upload
            name: Upload
        icon: mdi:upload-network-outline
        line_color: '#e74c3c'
        line_width: 8
        font_size: 75
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.speedtest_ping
            name: Ping
        line_color: var(--accent-color)
        line_width: 8
        font_size: 75

  - type: custom:vertical-stack-in-card
    cards:
      - type: horizontal-stack
        cards:
          - type: markdown
            content: "# Raspberry Pi Stats"
          - type: entities
            entities:
              - entity: input_select.pi_stats_legend_sensor_type
                name: Legend
                card_mod:
                  style:
                    hui-generic-entity-row:
                      $: |
                        state-badge {
                          display: none;
                        }
      - type: horizontal-stack
        cards:
          - type: custom:decluttering-card
            template: pi_stats_graph_card_template
            variables:
              - name: CPU Usage
              - sensor_suffix: _cpu_usage
              - hasspi_sensor: processor_use
              - upper_bound: ~75
              - icon: mdi:cpu-32-bit
          - type: custom:decluttering-card
            template: pi_stats_graph_card_template
            variables:
              - name: CPU Temperature
              - sensor_suffix: _cpu_temperature
              - hasspi_sensor: processor_temperature
              - upper_bound: 100
              - icon: mdi:thermometer-lines
      - type: horizontal-stack
        cards:
          - type: custom:decluttering-card
            template: pi_stats_graph_card_template
            variables:
              - name: Memory Usage
              - sensor_suffix: _memory_usage
              - hasspi_sensor: memory_use_percent
              - upper_bound: ~75
              - icon: mdi:memory
          - type: custom:decluttering-card
            template: pi_stats_graph_card_template
            variables:
              - name: Disk Usage
              - sensor_suffix: _disk_usage
              - hasspi_sensor: disk_use_percent
              - upper_bound: 100
              - icon: mdi:harddisk
      - type: conditional
        conditions:
          - entity: input_select.pi_stats_legend_sensor_type
            state: "CPU Usage"
        card:
          type: custom:decluttering-card
          template: pi_stats_legend_card_template
          variables:
            - sensor_suffix: _cpu_usage
            - hasspi_sensor: processor_use
      - type: conditional
        conditions:
          - entity: input_select.pi_stats_legend_sensor_type
            state: "CPU Temperature"
        card:
          type: custom:decluttering-card
          template: pi_stats_legend_card_template
          variables:
            - sensor_suffix: _cpu_temperature
            - hasspi_sensor: processor_temperature
      - type: conditional
        conditions:
          - entity: input_select.pi_stats_legend_sensor_type
            state: "Memory Usage"
        card:
          type: custom:decluttering-card
          template: pi_stats_legend_card_template
          variables:
            - sensor_suffix: _memory_usage
            - hasspi_sensor: memory_use_percent
      - type: conditional
        conditions:
          - entity: input_select.pi_stats_legend_sensor_type
            state: "Disk Usage"
        card:
          type: custom:decluttering-card
          template: pi_stats_legend_card_template
          variables:
            - sensor_suffix: _disk_usage
            - hasspi_sensor: disk_use_percent
      - type: entities
        entities:
          - binary_sensor.clmtpi_online
          - binary_sensor.crtpi_online
          - binary_sensor.growpi_online
          - binary_sensor.hasspi_online
          - binary_sensor.mtrxpi_online
          - binary_sensor.vsmppi_online
