---
# Custom automation for automatically reloading Pyscript when the files are updated -
#  no longer needed but kept here for reference
  - alias: Pyscript Auto-Reload
    trigger:
      platform: event
      event_type: folder_watcher
      event_data:
        event_type: modified
    condition: "{{ trigger.event.data.folder == '/config/pyscript' }}"
    action:
      - service: pyscript.reload
      - service: persistent_notification.create
        data:
          title: Pyscript has been reloaded
          message: >
            Triggered by `{{ trigger.event.data.folder }}/{{ trigger.event.data.file}}`

# ------------------------ Will's Room Curtain ------------------------

# When a change is detected by the sensor (from any source), set the input_number value
#  to change the slider on the front end
  - alias: Set Will's Room Curtain Position Slider
    trigger:
      platform: state
      entity_id: sensor.will_s_room_curtain_position
    condition:
      condition: template
      value_template: >
        {{ 
          ( trigger.from_state.state | int - trigger.to_state.state | int ) > 0 
        }}
    action:
      - service: input_number.set_value
        target:
          entity_id: input_number.wills_room_curtain_position
        data:
          value: '{{ trigger.to_state.state | int }}'

# When the slider (input number value) is changed, update the curtain position
  - alias: Will's Room Curtain Position Slider Moved
    mode: single
    max_exceeded: silent
    trigger:
      platform: state
      entity_id: input_number.wills_room_curtain_position
    action:
      - service: pyscript.set_curtain_position
        data:
          position: '{{ trigger.to_state.state | int }}'
      - delay: 5

